(this.webpackJsonpboardgames=this.webpackJsonpboardgames||[]).push([[7],{636:function(e,n,r){"use strict";r.d(n,"a",(function(){return s}));var t=r(50),a=r(1),s={STRIP_SECRETS:function(e,n,r){var s=Object(a.a)({},e);return void 0!==s.secret&&delete s.secret,s.players&&(s.players=Object(t.a)({},r,s.players[r])),s}}},638:function(e,n,r){"use strict";r.r(n),r.d(n,"isMoveInvalid",(function(){return f}));var t=r(11),a=r(50),s=r(1),l=r(3),u=r(636),i=r(203),c=["key","tower","moon"],d=[1,2,3,4,5,6,7,8,9,10,11];function o(e){for(var n,r=e.random.Shuffle(c.map((function(e){return d.map((function(n){return{suit:e,rank:n}}))})).flat()),t=[Object(s.a)(Object(s.a)({},r.pop()),{},{turn:0})],l=[],u=[],i=0;i<13;i++)l.push(r.pop()),u.push(r.pop());return{secret:{deck:r},tricks:[],trumps:t,players:(n={},Object(a.a)(n,"0",{hand:l,stashed:null}),Object(a.a)(n,"1",{hand:u,stashed:null}),n)}}function p(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=n.currentPlayer,l="0"===a?"1":"0",u=Object(t.a)(e.players[a].hand),i=null==r?Object(s.a)({},e.players[a].stashed):u[r];return{opponentID:l,playerID:a,hand:u,card:i}}function y(e){var n=e.length;return(n<=3?6:4===n?1:5===n?2:6===n?3:n>=7&&n<=9?6:0)+e.map((function(e){return e.cards})).flat().filter((function(e){return 7===e.rank})).length}function f(e,n){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];if(t.length>2)return"played_too_many_cards";var s=t[0],l=t[1],u=p(e,n,s),c=u.playerID,d=u.hand,o=u.card;if(null==s&&null==e.players[c].stashed)return"played_no_card";if(null==o)return"played_unknown_card";if(n.activePlayers&&"discard"===n.activePlayers[c])return null!=l?"discarded_extra_card":void 0;if(null!=l){if(3!==o.rank)return"played_extra_card";if(null==d[l])return"played_unknown_extra_card"}if(null!=e.played){var y=Object(i.g)(d,s).some((function(n){return n.suit===e.played.suit}));if(o.suit!==e.played.suit&&y)return"must_follow_suit";var f=d.filter((function(n){return n.suit===e.played.suit})).map((function(e){return e.rank})).reduce((function(e,n){return e<n?n:e}),-1);if(11===e.played.rank&&1!==o.rank&&o.rank!==f&&-1!==f)return"must_follow_11"}}function h(e,n,r){var t,a=p(e,n,r),s=a.playerID,l=a.opponentID,u=a.card,c=Object(i.c)(e.trumps).suit,d=u.rank,o=u.suit,y=e.played.rank,f=e.played.suit;return 9!==d&&9!==y||9===d&&9===y||(9===d?o=c:9===y&&(f=c)),{winner:t=o===c&&f!==c?s:o!==c&&f===c||o!==f?l:d>y?s:l,next:1===y&&t!==l?l:1===d&&t!==s?s:t}}function v(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(f(e,n,r,a))return l.t;var u=p(e,n,r),c=u.playerID,d=u.opponentID,v=u.hand,b=u.card;if(3===b.rank&&null!=a){var g=Object(s.a)({},Object(i.c)(e.trumps));e.trumps.push(Object(s.a)(Object(s.a)({},v[a]),{},{turn:n.turn})),v[a]=g}var m=Object(i.g)(v,r);if(5===b.rank&&null==e.players[c].stashed&&0!==m.length){var j=e.secret.deck.pop();return e.players[c].hand=[].concat(Object(t.a)(m),[j]),e.players[c].stashed=b,void n.events.setStage("discard")}if(null==e.played)return e.players[c].stashed=null,e.players[c].hand=m,e.played=b,void n.events.endTurn();var O=h(e,n,r),k=O.winner,w=O.next;if(e.tricks.push({winner:k,cards:[Object(s.a)({},e.played),Object(s.a)({},b)]}),e.played=null,e.players[c].stashed=null,e.players[c].hand=m,0===m.length){for(var _=function(){var n=I[S],r=y(e.tricks.filter((function(e){return e.winner===n})));e.scores[n].push(r)},S=0,I=[c,d];S<I.length;S++)_();var P=o(n);e.history.push(e.tricks),e.secret=P.secret,e.tricks=P.tricks,e.trumps=P.trumps,e.players=P.players,w="0"===e.startingPlayer?"1":"0",e.startingPlayer=w}n.events.endTurn({next:w})}n.default={name:"the-vole-in-the-valley",minPlayers:2,maxPlayers:2,setupDataSchema:{required:[],properties:{longGame:{title:"Long game",type:"boolean"}}},setup:function(e,n){var r;return Object(s.a)(Object(s.a)({},o(e)),{},{played:null,scores:(r={},Object(a.a)(r,"0",[]),Object(a.a)(r,"1",[]),r),history:[],startingPlayer:"0",winningScore:(null===n||void 0===n?void 0:n.longGame)?21:16})},moves:{playCard:{move:v,client:!1}},turn:{stages:{discard:{moves:{discardCard:{move:function(e,n,r){var t=p(e,n),a=t.playerID,s=t.hand;e.players[a].hand=Object(i.g)(s,r),n.events.endStage(),v(e,n)},client:!1}}}}},endIf:function(e,n){var r=p(e,n),t=r.playerID,a=r.opponentID,s=e.scores[t],l=e.scores[a],u=Object(i.h)(s),c=Object(i.h)(l);if(!(u<e.winningScore&&c<e.winningScore))return u>c?{winner:t}:c>u?{winner:a}:Object(i.c)(s)>Object(i.c)(l)?{winner:t}:{winner:a}},playerView:u.a.STRIP_SECRETS,events:{endStage:!1,endTurn:!1,endPhase:!1,endGame:!1,setStage:!1,setPhase:!1,setActivePlayers:!1},disableUndo:!0}}}]);
//# sourceMappingURL=7.50efdbd7.chunk.js.map