(this.webpackJsonpboardgames=this.webpackJsonpboardgames||[]).push([[7],{588:function(e,r,n){"use strict";n.d(r,"a",(function(){return l}));var t=n(50),a=n(1),l={STRIP_SECRETS:function(e,r,n){var l=Object(a.a)({},e);return void 0!==l.secret&&delete l.secret,l.players&&(l.players=Object(t.a)({},n,l.players[n])),l}}},589:function(e,r,n){"use strict";n.r(r),n.d(r,"isMoveInvalid",(function(){return f}));var t=n(11),a=n(50),l=n(1),s=n(3),u=n(588),i=n(199),c=["key","tower","moon"],d=[1,2,3,4,5,6,7,8,9,10,11];function o(e){for(var r,n=e.random.Shuffle(c.map((function(e){return d.map((function(r){return{suit:e,rank:r}}))})).flat()),t=[Object(l.a)(Object(l.a)({},n.pop()),{},{turn:0})],s=[],u=[],i=0;i<13;i++)s.push(n.pop()),u.push(n.pop());return{secret:{deck:n},tricks:[],trumps:t,players:(r={},Object(a.a)(r,"0",{hand:s,stashed:null}),Object(a.a)(r,"1",{hand:u,stashed:null}),r)}}function p(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=r.currentPlayer,s="0"===a?"1":"0",u=Object(t.a)(e.players[a].hand),i=null==n?Object(l.a)({},e.players[a].stashed):u[n];return{opponentID:s,playerID:a,hand:u,card:i}}function y(e){var r=e.length;return(r<=3?6:4===r?1:5===r?2:6===r?3:r>=7&&r<=9?6:0)+e.map((function(e){return e.cards})).flat().filter((function(e){return 7===e.rank})).length}function f(e,r){for(var n=arguments.length,t=new Array(n>2?n-2:0),a=2;a<n;a++)t[a-2]=arguments[a];if(t.length>2)return"played_too_many_cards";var l=t[0],s=t[1],u=p(e,r,l),c=u.playerID,d=u.hand,o=u.card;if(null==l&&null==e.players[c].stashed)return"played_no_card";if(null==o)return"played_unknown_card";if(r.activePlayers&&"discard"===r.activePlayers[c])return null!=s?"discarded_extra_card":void 0;if(null!=s){if(3!==o.rank)return"played_extra_card";if(null==d[s])return"played_unknown_extra_card"}if(null!=e.played){var y=Object(i.g)(d,l).some((function(r){return r.suit===e.played.suit}));if(o.suit!==e.played.suit&&y)return"must_follow_suit";var f=d.filter((function(r){return r.suit===e.played.suit})).map((function(e){return e.rank})).reduce((function(e,r){return e<r?r:e}),-1);if(11===e.played.rank&&1!==o.rank&&o.rank!==f&&-1!==f)return"must_follow_11"}}function h(e,r,n){var t,a=p(e,r,n),l=a.playerID,s=a.opponentID,u=a.card,c=Object(i.c)(e.trumps).suit,d=u.rank,o=u.suit,y=e.played.rank,f=e.played.suit;return 9!==d&&9!==y||9===d&&9===y||(9===d?o=c:9===y&&(f=c)),{winner:t=o===c&&f!==c?l:o!==c&&f===c||o!==f?s:d>y?l:s,next:1===y&&t!==s?s:1===d&&t!==l?l:t}}function v(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(f(e,r,n,a))return s.t;var u=p(e,r,n),c=u.playerID,d=u.opponentID,v=u.hand,b=u.card;if(3===b.rank&&null!=a){var g=Object(l.a)({},Object(i.c)(e.trumps));e.trumps.push(Object(l.a)(Object(l.a)({},v[a]),{},{turn:r.turn})),v[a]=g}var m=Object(i.g)(v,n);if(5===b.rank&&null==e.players[c].stashed&&0!==m.length){var j=e.secret.deck.pop();return e.players[c].hand=[].concat(Object(t.a)(m),[j]),e.players[c].stashed=b,void r.events.setStage("discard")}if(null==e.played)return e.players[c].stashed=null,e.players[c].hand=m,e.played=b,void r.events.endTurn();var O=h(e,r,n),k=O.winner,w=O.next;if(e.tricks.push({winner:k,cards:[Object(l.a)(Object(l.a)({},e.played),{},{playerID:d}),Object(l.a)(Object(l.a)({},b),{},{playerID:c})]}),e.played=null,e.players[c].stashed=null,e.players[c].hand=m,0===m.length){for(var _=function(){var r=S[I],n=y(e.tricks.filter((function(e){return e.winner===r})));e.scores[r].push(n)},I=0,S=[c,d];I<S.length;I++)_();var D=o(r);e.history.push(e.tricks),e.secret=D.secret,e.tricks=D.tricks,e.trumps=D.trumps,e.players=D.players,w="0"===e.startingPlayer?"1":"0",e.startingPlayer=w}r.events.endTurn({next:w})}r.default={name:"the-vole-in-the-valley",minPlayers:2,maxPlayers:2,setupDataSchema:{required:[],properties:{longGame:{title:"Long game",type:"boolean"}}},setup:function(e,r){var n;return Object(l.a)(Object(l.a)({},o(e)),{},{played:null,scores:(n={},Object(a.a)(n,"0",[]),Object(a.a)(n,"1",[]),n),history:[],startingPlayer:"0",winningScore:(null===r||void 0===r?void 0:r.longGame)?21:16})},moves:{playCard:{move:v,client:!1}},turn:{stages:{discard:{moves:{discardCard:{move:function(e,r,n){var t=p(e,r),a=t.playerID,l=t.hand;e.players[a].hand=Object(i.g)(l,n),r.events.endStage(),v(e,r)},client:!1}}}}},endIf:function(e,r){var n=p(e,r),t=n.playerID,a=n.opponentID,l=e.scores[t],s=e.scores[a],u=Object(i.h)(l),c=Object(i.h)(s);if(!(u<e.winningScore&&c<e.winningScore))return u>c?{winner:t}:c>u?{winner:a}:Object(i.c)(l)>Object(i.c)(s)?{winner:t}:{winner:a}},playerView:u.a.STRIP_SECRETS,events:{endStage:!1,endTurn:!1,endPhase:!1,endGame:!1,setStage:!1,setPhase:!1,setActivePlayers:!1},disableUndo:!0}}}]);
//# sourceMappingURL=7.7a66d044.chunk.js.map