/*! For license information please see 3.319e64c7.chunk.js.LICENSE.txt */
(this.webpackJsonpboardgames=this.webpackJsonpboardgames||[]).push([[3,5,7],{636:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(50),r=a(1),c={STRIP_SECRETS:function(e,t,a){var c=Object(r.a)({},e);return void 0!==c.secret&&delete c.secret,c.players&&(c.players=Object(n.a)({},a,c.players[a])),c}}},637:function(e,t,a){var n;!function(){"use strict";var a={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var c=typeof n;if("string"===c||"number"===c)e.push(n);else if(Array.isArray(n)&&n.length){var l=r.apply(null,n);l&&e.push(l)}else if("object"===c)for(var s in n)a.call(n,s)&&n[s]&&e.push(s)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()},638:function(e,t,a){"use strict";a.r(t),a.d(t,"isMoveInvalid",(function(){return h}));var n=a(11),r=a(50),c=a(1),l=a(3),s=a(636),i=a(203),u=["key","tower","moon"],o=[1,2,3,4,5,6,7,8,9,10,11];function d(e){for(var t,a=e.random.Shuffle(u.map((function(e){return o.map((function(t){return{suit:e,rank:t}}))})).flat()),n=[Object(c.a)(Object(c.a)({},a.pop()),{},{turn:0})],l=[],s=[],i=0;i<13;i++)l.push(a.pop()),s.push(a.pop());return{secret:{deck:a},tricks:[],trumps:n,players:(t={},Object(r.a)(t,"0",{hand:l,stashed:null}),Object(r.a)(t,"1",{hand:s,stashed:null}),t)}}function p(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.currentPlayer,l="0"===r?"1":"0",s=Object(n.a)(e.players[r].hand),i=null==a?Object(c.a)({},e.players[r].stashed):s[a];return{opponentID:l,playerID:r,hand:s,card:i}}function m(e){var t=e.length;return(t<=3?6:4===t?1:5===t?2:6===t?3:t>=7&&t<=9?6:0)+e.map((function(e){return e.cards})).flat().filter((function(e){return 7===e.rank})).length}function h(e,t){for(var a=arguments.length,n=new Array(a>2?a-2:0),r=2;r<a;r++)n[r-2]=arguments[r];if(n.length>2)return"played_too_many_cards";var c=n[0],l=n[1],s=p(e,t,c),u=s.playerID,o=s.hand,d=s.card;if(null==c&&null==e.players[u].stashed)return"played_no_card";if(null==d)return"played_unknown_card";if(t.activePlayers&&"discard"===t.activePlayers[u])return null!=l?"discarded_extra_card":void 0;if(null!=l){if(3!==d.rank)return"played_extra_card";if(null==o[l])return"played_unknown_extra_card"}if(null!=e.played){var m=Object(i.g)(o,c).some((function(t){return t.suit===e.played.suit}));if(d.suit!==e.played.suit&&m)return"must_follow_suit";var h=o.filter((function(t){return t.suit===e.played.suit})).map((function(e){return e.rank})).reduce((function(e,t){return e<t?t:e}),-1);if(11===e.played.rank&&1!==d.rank&&d.rank!==h&&-1!==h)return"must_follow_11"}}function f(e,t,a){var n,r=p(e,t,a),c=r.playerID,l=r.opponentID,s=r.card,u=Object(i.c)(e.trumps).suit,o=s.rank,d=s.suit,m=e.played.rank,h=e.played.suit;return 9!==o&&9!==m||9===o&&9===m||(9===o?d=u:9===m&&(h=u)),{winner:n=d===u&&h!==u?c:d!==u&&h===u||d!==h?l:o>m?c:l,next:1===m&&n!==l?l:1===o&&n!==c?c:n}}function y(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(h(e,t,a,r))return l.t;var s=p(e,t,a),u=s.playerID,o=s.opponentID,y=s.hand,v=s.card;if(3===v.rank&&null!=r){var b=Object(c.a)({},Object(i.c)(e.trumps));e.trumps.push(Object(c.a)(Object(c.a)({},y[r]),{},{turn:t.turn})),y[r]=b}var k=Object(i.g)(y,a);if(5===v.rank&&null==e.players[u].stashed&&0!==k.length){var E=e.secret.deck.pop();return e.players[u].hand=[].concat(Object(n.a)(k),[E]),e.players[u].stashed=v,void t.events.setStage("discard")}if(null==e.played)return e.players[u].stashed=null,e.players[u].hand=k,e.played=v,void t.events.endTurn();var g=f(e,t,a),O=g.winner,j=g.next;if(e.tricks.push({winner:O,cards:[Object(c.a)({},e.played),Object(c.a)({},v)]}),e.played=null,e.players[u].stashed=null,e.players[u].hand=k,0===k.length){for(var w=function(){var t=S[N],a=m(e.tricks.filter((function(e){return e.winner===t})));e.scores[t].push(a)},N=0,S=[u,o];N<S.length;N++)w();var _=d(t);e.history.push(e.tricks),e.secret=_.secret,e.tricks=_.tricks,e.trumps=_.trumps,e.players=_.players,j="0"===e.startingPlayer?"1":"0",e.startingPlayer=j}t.events.endTurn({next:j})}t.default={name:"the-vole-in-the-valley",minPlayers:2,maxPlayers:2,setupDataSchema:{required:[],properties:{longGame:{title:"Long game",type:"boolean"}}},setup:function(e,t){var a;return Object(c.a)(Object(c.a)({},d(e)),{},{played:null,scores:(a={},Object(r.a)(a,"0",[]),Object(r.a)(a,"1",[]),a),history:[],startingPlayer:"0",winningScore:(null===t||void 0===t?void 0:t.longGame)?21:16})},moves:{playCard:{move:y,client:!1}},turn:{stages:{discard:{moves:{discardCard:{move:function(e,t,a){var n=p(e,t),r=n.playerID,c=n.hand;e.players[r].hand=Object(i.g)(c,a),t.events.endStage(),y(e,t)},client:!1}}}}},endIf:function(e,t){var a=p(e,t),n=a.playerID,r=a.opponentID,c=e.scores[n],l=e.scores[r],s=Object(i.h)(c),u=Object(i.h)(l);if(!(s<e.winningScore&&u<e.winningScore))return s>u?{winner:n}:u>s?{winner:r}:Object(i.c)(c)>Object(i.c)(l)?{winner:n}:{winner:r}},playerView:s.a.STRIP_SECRETS,events:{endStage:!1,endTurn:!1,endPhase:!1,endGame:!1,setStage:!1,setPhase:!1,setActivePlayers:!1},disableUndo:!0}},639:function(e,t,a){},643:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return h}));var n=a(11),r=a(20),c=a(0),l=a.n(c),s=a(19),i=a(637),u=a.n(i),o=a(638),d=a(203),p=(a(639),{1:"If you play this and lose the trick, you lead the next trick.",3:"When you play this, you may exchange the trump card with a card from your hand.",5:"When you play this, draw 1 card. Then discard any 1 card to the bottom of the deck (face down).",7:"The winner of the trick receives 1 point for each 7 in the trick.",9:"When determining the winner of a trick with only one 9, treat the 9 as if it were in the trump suit.",11:"When you lead this, if your opponent has a card of this suit, they must play either the 1 of this suit or their highest ranked card of this suit."});function m(e){var t=e.card,a=e.compact,n=e.won,r=e.isNew,c=e.isOld;return l.a.createElement("span",{className:u()("card",t.suit,{won:n,new:r,old:c})},l.a.createElement("span",{className:u()("content",{compact:a})},l.a.createElement("span",{className:"rank"},t.rank),l.a.createElement("span",{className:"suit"},t.suit)))}function h(e){var t=e.G,a=e.ctx,i=e.playerID,h=e.moves,f=e.matchData,y=Object(s.g)(),v=Object(c.useState)([]),b=Object(r.a)(v,2),k=b[0],E=b[1],g=Object(c.useState)(!1),O=Object(r.a)(g,2),j=O[0],w=O[1],N=function(e){return function(t){t.target.checked?E([].concat(Object(n.a)(k),[e])):E(k.filter((function(t){return t!==e})))}},S=function(e){return!!P&&(!!k.includes(e)||(I?0===k.length:!o.isMoveInvalid.apply(void 0,[t,a].concat(Object(n.a)(k),[e]))))},_=null!=a.gameover,D=_&&a.gameover.winner===i,P=i===a.currentPlayer,I=a.activePlayers&&"discard"===a.activePlayers[i],x=0===t.tricks.length&&t.history.length>0,T=t.players[i],C=f.find((function(e){return e.id!==Number(i)})),Y=t.tricks.filter((function(e){return e.winner===i})).length,W=t.tricks.filter((function(e){return e.winner!==i})).length,A=Object(d.c)(t.trumps),G=A.turn>0&&a.turn-A.turn<=1?t.trumps[t.trumps.length-2]:null,R=x&&j?Object(d.c)(Object(d.c)(t.history)):t.tricks.length>=1?Object(d.c)(t.tricks):null,H=k.length>0?p[T.hand[k[0]].rank]:null;Object(c.useEffect)((function(){x&&w(!0)}),[w,x]);var J=T.hand.map((function(e,t){return{card:e,i:t}})).sort((function(e,t){return e.card.suit===t.card.suit?e.card.rank-t.card.rank:e.card.suit.localeCompare(t.card.suit)})),L=function(e){var a=e.showHistory,n=void 0!==a&&a,r=e.hideTricks,c=void 0!==r&&r;return l.a.createElement("div",{className:"stats"},l.a.createElement("div",{className:"score"},l.a.createElement("span",{className:"label"},"Your score"),l.a.createElement("span",null,Object(d.h)(t.scores[i])),n&&l.a.createElement("span",null,"(+ ",Object(d.c)(t.scores[i]),")")),l.a.createElement("div",{className:"score"},l.a.createElement("span",{className:"label"},C.name," score"),l.a.createElement("span",null,Object(d.h)(t.scores[C.id])),n&&l.a.createElement("span",null,"(+ ",Object(d.c)(t.scores[C.id]),")")),!c&&l.a.createElement("div",{className:"tricks"},l.a.createElement("span",{className:"label"},"Your tricks"),l.a.createElement("span",null,Y)),!c&&l.a.createElement("div",{className:"tricks"},l.a.createElement("span",{className:"label"},C.name," tricks"),l.a.createElement("span",null,W)))};return _?l.a.createElement("form",{onSubmit:function(e){e.preventDefault(),y.push("/new")}},l.a.createElement(L,{showHistory:!0,hideTricks:!0}),l.a.createElement("div",null,l.a.createElement("em",null,D?"You won!":"You lost.")),l.a.createElement("input",{type:"submit",value:"Click to play another game"})):j?l.a.createElement("form",{onSubmit:function(e){e.preventDefault(),w(!1)}},l.a.createElement(L,{showHistory:!0,hideTricks:!0}),l.a.createElement("input",{type:"submit",value:"Ok, proceed to next round"})):l.a.createElement("form",{onSubmit:I?function(e){e.preventDefault(),h.discardCard.apply(h,Object(n.a)(k)),E([])}:function(e){e.preventDefault(),h.playCard.apply(h,Object(n.a)(k)),E([])},className:u()({disabled:!P})},l.a.createElement("div",{className:"board"},l.a.createElement("div",{className:"info"},l.a.createElement(L,null),l.a.createElement("div",{className:"current-trick"},l.a.createElement("em",null,P?"Your move!":"Waiting for ".concat(C.name,"...")),t.played&&l.a.createElement("div",{className:"played"},l.a.createElement("div",{className:"label"},P?"".concat(C.name," played"):"You played"),l.a.createElement(m,{card:t.played}))),l.a.createElement("div",{className:"history"},l.a.createElement("div",{className:"trump"},l.a.createElement("span",{className:"label"},"Trump"),G&&l.a.createElement(m,{card:G,compact:!0,isOld:!0}),l.a.createElement(m,{card:A,compact:!0})),R&&l.a.createElement("div",{className:"last-trick"},l.a.createElement("span",{className:"label"},"Last"),l.a.createElement(m,{card:R.cards[0],compact:!0,won:"0"===R.winner}),l.a.createElement(m,{card:R.cards[1],compact:!0,won:"1"===R.winner})))),l.a.createElement("ol",{className:"hand"},J.map((function(e){var t=e.card,a=e.i;return l.a.createElement("li",{key:"".concat(t.rank,"-").concat(t.suit)},l.a.createElement("label",null,l.a.createElement("input",{type:"checkbox",onChange:N(a),disabled:!S(a),checked:k.includes(a)}),l.a.createElement(m,{card:t,isNew:I&&a===J.length-1})))})))),l.a.createElement("input",{type:"submit",disabled:!P||0===k.length,value:I?"Discard card":"Play card"}),H&&l.a.createElement("aside",null,H))}}}]);
//# sourceMappingURL=3.319e64c7.chunk.js.map