(this.webpackJsonpboardgames=this.webpackJsonpboardgames||[]).push([[3,5,7],{588:function(e,a,t){"use strict";t.d(a,"a",(function(){return c}));var n=t(50),r=t(1),c={STRIP_SECRETS:function(e,a,t){var c=Object(r.a)({},e);return void 0!==c.secret&&delete c.secret,c.players&&(c.players=Object(n.a)({},t,c.players[t])),c}}},589:function(e,a,t){"use strict";t.r(a),t.d(a,"isMoveInvalid",(function(){return h}));var n=t(11),r=t(50),c=t(1),l=t(3),s=t(588),i=t(199),u=["key","tower","moon"],o=[1,2,3,4,5,6,7,8,9,10,11];function d(e){for(var a,t=e.random.Shuffle(u.map((function(e){return o.map((function(a){return{suit:e,rank:a}}))})).flat()),n=[Object(c.a)(Object(c.a)({},t.pop()),{},{turn:0})],l=[],s=[],i=0;i<13;i++)l.push(t.pop()),s.push(t.pop());return{secret:{deck:t},tricks:[],trumps:n,players:(a={},Object(r.a)(a,"0",{hand:l,stashed:null}),Object(r.a)(a,"1",{hand:s,stashed:null}),a)}}function p(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=a.currentPlayer,l="0"===r?"1":"0",s=Object(n.a)(e.players[r].hand),i=null==t?Object(c.a)({},e.players[r].stashed):s[t];return{opponentID:l,playerID:r,hand:s,card:i}}function m(e){var a=e.length;return(a<=3?6:4===a?1:5===a?2:6===a?3:a>=7&&a<=9?6:0)+e.map((function(e){return e.cards})).flat().filter((function(e){return 7===e.rank})).length}function h(e,a){for(var t=arguments.length,n=new Array(t>2?t-2:0),r=2;r<t;r++)n[r-2]=arguments[r];if(n.length>2)return"played_too_many_cards";var c=n[0],l=n[1],s=p(e,a,c),u=s.playerID,o=s.hand,d=s.card;if(null==c&&null==e.players[u].stashed)return"played_no_card";if(null==d)return"played_unknown_card";if(a.activePlayers&&"discard"===a.activePlayers[u])return null!=l?"discarded_extra_card":void 0;if(null!=l){if(3!==d.rank)return"played_extra_card";if(null==o[l])return"played_unknown_extra_card"}if(null!=e.played){var m=Object(i.g)(o,c).some((function(a){return a.suit===e.played.suit}));if(d.suit!==e.played.suit&&m)return"must_follow_suit";var h=o.filter((function(a){return a.suit===e.played.suit})).map((function(e){return e.rank})).reduce((function(e,a){return e<a?a:e}),-1);if(11===e.played.rank&&1!==d.rank&&d.rank!==h&&-1!==h)return"must_follow_11"}}function y(e,a,t){var n,r=p(e,a,t),c=r.playerID,l=r.opponentID,s=r.card,u=Object(i.c)(e.trumps).suit,o=s.rank,d=s.suit,m=e.played.rank,h=e.played.suit;return 9!==o&&9!==m||9===o&&9===m||(9===o?d=u:9===m&&(h=u)),{winner:n=d===u&&h!==u?c:d!==u&&h===u||d!==h?l:o>m?c:l,next:1===m&&n!==l?l:1===o&&n!==c?c:n}}function f(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(h(e,a,t,r))return l.t;var s=p(e,a,t),u=s.playerID,o=s.opponentID,f=s.hand,v=s.card;if(3===v.rank&&null!=r){var b=Object(c.a)({},Object(i.c)(e.trumps));e.trumps.push(Object(c.a)(Object(c.a)({},f[r]),{},{turn:a.turn})),f[r]=b}var E=Object(i.g)(f,t);if(5===v.rank&&null==e.players[u].stashed&&0!==E.length){var g=e.secret.deck.pop();return e.players[u].hand=[].concat(Object(n.a)(E),[g]),e.players[u].stashed=v,void a.events.setStage("discard")}if(null==e.played)return e.players[u].stashed=null,e.players[u].hand=E,e.played=v,void a.events.endTurn();var k=y(e,a,t),O=k.winner,j=k.next;if(e.tricks.push({winner:O,cards:[Object(c.a)(Object(c.a)({},e.played),{},{playerID:o}),Object(c.a)(Object(c.a)({},v),{},{playerID:u})]}),e.played=null,e.players[u].stashed=null,e.players[u].hand=E,0===E.length){for(var w=function(){var a=D[N],t=m(e.tricks.filter((function(e){return e.winner===a})));e.scores[a].push(t)},N=0,D=[u,o];N<D.length;N++)w();var I=d(a);e.history.push(e.tricks),e.secret=I.secret,e.tricks=I.tricks,e.trumps=I.trumps,e.players=I.players,j="0"===e.startingPlayer?"1":"0",e.startingPlayer=j}a.events.endTurn({next:j})}a.default={name:"the-vole-in-the-valley",minPlayers:2,maxPlayers:2,setupDataSchema:{required:[],properties:{longGame:{title:"Long game",type:"boolean"}}},setup:function(e,a){var t;return Object(c.a)(Object(c.a)({},d(e)),{},{played:null,scores:(t={},Object(r.a)(t,"0",[]),Object(r.a)(t,"1",[]),t),history:[],startingPlayer:"0",winningScore:(null===a||void 0===a?void 0:a.longGame)?21:16})},moves:{playCard:{move:f,client:!1}},turn:{stages:{discard:{moves:{discardCard:{move:function(e,a,t){var n=p(e,a),r=n.playerID,c=n.hand;e.players[r].hand=Object(i.g)(c,t),a.events.endStage(),f(e,a)},client:!1}}}}},endIf:function(e,a){var t=p(e,a),n=t.playerID,r=t.opponentID,c=e.scores[n],l=e.scores[r],s=Object(i.h)(c),u=Object(i.h)(l);if(!(s<e.winningScore&&u<e.winningScore))return s>u?{winner:n}:u>s?{winner:r}:Object(i.c)(c)>Object(i.c)(l)?{winner:n}:{winner:r}},playerView:s.a.STRIP_SECRETS,events:{endStage:!1,endTurn:!1,endPhase:!1,endGame:!1,setStage:!1,setPhase:!1,setActivePlayers:!1},disableUndo:!0}},590:function(e,a,t){},594:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return h}));var n=t(11),r=t(20),c=t(0),l=t.n(c),s=t(19),i=t(202),u=t.n(i),o=t(589),d=t(199),p=(t(590),{1:"If you play this and lose the trick, you lead the next trick.",3:"When you play this, you may exchange the trump card with a card from your hand.",5:"When you play this, draw 1 card. Then discard any 1 card.",7:"The winner of the trick receives 1 point for each 7 in the trick.",9:"When determining the winner of a trick with only one 9, treat the 9 as if it were in the trump suit.",11:"When you lead this, if your opponent has a card of this suit, they must play either the 1 of this suit or their highest ranked card of this suit."});function m(e){var a=e.card,t=e.compact,n=e.won,r=e.isNew,c=e.isOld;return l.a.createElement("span",{className:u()("card",a.suit,{won:n,new:r,old:c})},l.a.createElement("span",{className:u()("content",{compact:t})},l.a.createElement("span",{className:"rank"},a.rank),l.a.createElement("span",{className:"suit"},a.suit)))}function h(e){var a=e.G,t=e.ctx,i=e.playerID,h=e.moves,y=e.matchData,f=Object(s.g)(),v=Object(c.useState)([]),b=Object(r.a)(v,2),E=b[0],g=b[1],k=Object(c.useState)(!1),O=Object(r.a)(k,2),j=O[0],w=O[1],N=function(e){return function(a){a.target.checked?g([].concat(Object(n.a)(E),[e])):g(E.filter((function(a){return a!==e})))}},D=function(e){return!!I&&(!!E.includes(e)||(S?0===E.length:!o.isMoveInvalid.apply(void 0,[a,t].concat(Object(n.a)(E),[e]))))},I=i===t.currentPlayer,S=t.activePlayers&&"discard"===t.activePlayers[i],_=0===a.tricks.length&&a.history.length>0,P=a.players[i],T=y.find((function(e){return e.id!==Number(i)})),x=T.id.toString(),C=a.tricks.filter((function(e){return e.winner===i})).length,W=a.tricks.filter((function(e){return e.winner!==i})).length,Y=Object(d.c)(a.trumps),G=Y.turn>0&&t.turn-Y.turn<=1?a.trumps[a.trumps.length-2]:null,R=_&&j?Object(d.c)(Object(d.c)(a.history)):a.tricks.length>=1?Object(d.c)(a.tricks):null,H=E.length>0?p[P.hand[E[0]].rank]:null;Object(c.useEffect)((function(){_&&w(!0)}),[w,_]);var A=P.hand.map((function(e,a){return{card:e,i:a}})).sort((function(e,a){return e.card.suit===a.card.suit?e.card.rank-a.card.rank:e.card.suit.localeCompare(a.card.suit)})),J=function(e){var n,r,c=e.showHistory,s=void 0!==c&&c,u=e.hideTricks,o=void 0!==u&&u;return l.a.createElement("div",{className:"stats"},l.a.createElement("div",{className:"score"},l.a.createElement("span",{className:"label"},"Your score"),l.a.createElement("span",null,Object(d.h)(a.scores[i])),s&&l.a.createElement("span",null,"(+ ",Object(d.c)(a.scores[i]),")"),(null===(n=t.gameover)||void 0===n?void 0:n.winner)===i&&l.a.createElement("span",null,l.a.createElement("span",{role:"img","aria-label":"You won"},"\ud83d\udc51"))),l.a.createElement("div",{className:"score"},l.a.createElement("span",{className:"label"},T.name," score"),l.a.createElement("span",null,Object(d.h)(a.scores[x])),s&&l.a.createElement("span",null,"(+ ",Object(d.c)(a.scores[x]),")"),(null===(r=t.gameover)||void 0===r?void 0:r.winner)===x&&l.a.createElement("span",null,l.a.createElement("span",{role:"img","aria-label":"".concat(T.name," won")},"\ud83d\udc51"))),!o&&l.a.createElement("div",{className:"tricks"},l.a.createElement("span",{className:"label"},"Your tricks"),l.a.createElement("span",null,C)),!o&&l.a.createElement("div",{className:"tricks"},l.a.createElement("span",{className:"label"},T.name," tricks"),l.a.createElement("span",null,W)))};return t.gameover?l.a.createElement("form",{onSubmit:function(e){e.preventDefault(),f.push("/new")},className:"end-of-game"},l.a.createElement(J,{showHistory:!0,hideTricks:!0}),l.a.createElement("input",{type:"submit",value:"Play again"})):j?l.a.createElement("form",{onSubmit:function(e){e.preventDefault(),w(!1)},className:"end-of-round"},l.a.createElement(J,{showHistory:!0,hideTricks:!0}),l.a.createElement("input",{type:"submit",value:"Continue"})):l.a.createElement("form",{onSubmit:S?function(e){e.preventDefault(),h.discardCard.apply(h,Object(n.a)(E)),g([])}:function(e){e.preventDefault(),h.playCard.apply(h,Object(n.a)(E)),g([])},className:u()({disabled:!I})},l.a.createElement("div",{className:"board"},l.a.createElement("div",{className:"info"},l.a.createElement(J,null),l.a.createElement("div",{className:"current-trick"},l.a.createElement("em",null,I?"Your move!":"Waiting for ".concat(T.name,"\u2026")),a.played&&l.a.createElement("div",{className:"played"},l.a.createElement("div",{className:"label"},I?"".concat(T.name," played"):"You played"),l.a.createElement(m,{card:a.played}))),l.a.createElement("div",{className:"history"},l.a.createElement("div",{className:"trump"},l.a.createElement("span",{className:"label"},"Trump"),G&&l.a.createElement(m,{card:G,compact:!0,isOld:!0}),l.a.createElement(m,{card:Y,compact:!0})),R&&l.a.createElement("div",{className:"last-trick"},l.a.createElement("span",{className:"label"},"Last"),l.a.createElement(m,{card:R.cards[0],compact:!0,won:R.winner===R.cards[0].playerID}),l.a.createElement(m,{card:R.cards[1],compact:!0,won:R.winner===R.cards[1].playerID})))),l.a.createElement("ol",{className:"hand"},A.map((function(e){var a=e.card,t=e.i;return l.a.createElement("li",{key:"".concat(a.rank,"-").concat(a.suit)},l.a.createElement("label",null,l.a.createElement("input",{type:"checkbox",onChange:N(t),disabled:!D(t),checked:E.includes(t)}),l.a.createElement(m,{card:a,isNew:S&&t===A.length-1})))})))),l.a.createElement("input",{type:"submit",disabled:!I||0===E.length,value:S?"Discard card":"Play card"}),H&&l.a.createElement("aside",null,H))}}}]);
//# sourceMappingURL=3.d96e3226.chunk.js.map